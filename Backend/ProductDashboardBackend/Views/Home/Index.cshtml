@model ProductDashboard.Models.ViewModels.ProductListViewModel

<div class="dashboard-container" style="min-height: 70vh; background: linear-gradient(to bottom, #FDF6E3, #FFFFFF); padding: 2rem 0;">
    <!-- Loading Indicator - Themed -->
    <div id="loadingIndicator" class="text-center d-none py-5">
        <div class="spinner-border" role="status" style="width: 3rem; height: 3rem; color: #E67E22;">
            <span class="visually-hidden">Loading delicious dishes...</span>
        </div>
        <p class="mt-3" style="font-family: 'Playfair Display', serif; color: #2C3E50;">
            Preparing your culinary experience...
        </p>
    </div>

    <!-- Product List Container -->
    <div id="productContainer">
        @await Html.PartialAsync("~/Views/Product/_ProductList.cshtml", Model)
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            console.log('Document ready - initializing pagination');

            // Handle pagination clicks - FIXED SELECTOR
            $(document).on('click', '.pagination .page-link[data-page]', function (e) {
                e.preventDefault();
                console.log('Pagination link clicked');

                var page = $(this).data('page');
                var searchTerm = $('#searchInput').val();
                var categoryId = $('#categoryFilter').val();

                console.log('Loading page:', page, 'Search:', searchTerm, 'Category:', categoryId);
                loadProducts(searchTerm, categoryId, page);
            });

            // Handle search and filter changes
            $('#searchInput, #categoryFilter').on('input change', function () {
                var searchTerm = $('#searchInput').val();
                var categoryId = $('#categoryFilter').val();
                console.log('Filter changed - Search:', searchTerm, 'Category:', categoryId);
                loadProducts(searchTerm, categoryId, 1);
            });
        });

                // In your loadProducts function, the server will now handle 8 items per page
        function loadProducts(searchTerm, categoryId, page) {
            // Show loading indicator
            $('#loadingIndicator').removeClass('d-none');
            $('#productContainer').addClass('opacity-50');

            $.ajax({
                url: '@Url.Action("ProductList", "Home")',
                type: 'GET',
                data: {
                    searchTerm: searchTerm,
                    categoryId: categoryId,
                    page: page
                },
                success: function (result) {
                    $('#productContainer').html(result);
                    // Smooth scroll to top of products
                    $('html, body').animate({
                        scrollTop: $('#productContainer').offset().top - 100
                    }, 300);
                },
                error: function (xhr, status, error) {
                    console.error('Error loading products:', error);
                },
                complete: function () {
                    $('#loadingIndicator').addClass('d-none');
                    $('#productContainer').removeClass('opacity-50');
                }
            });
        }

        function clearFilters() {
            console.log('Clearing filters');
            $('#searchInput').val('');
            $('#categoryFilter').val('');
            loadProducts('', '', 1);
        }
    </script>

    <style>
        .opacity-50 {
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .dashboard-container {
            transition: opacity 0.3s ease-in-out;
        }

        #loadingIndicator {
            transition: all 0.3s ease-in-out;
        }

        /* Smooth appearance for product grid */
        #productGrid {
            animation: fadeIn 0.5s ease-in-out;
        }

        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Pagination hover effects */
        .page-link:hover:not(.disabled):not(.active) {
            background-color: #DAA520 !important;
            color: #2C3E50 !important;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        .page-link.disabled {
            background-color: #BDC3C7 !important;
            color: #7F8C8D !important;
            cursor: not-allowed;
        }
    </style>
}