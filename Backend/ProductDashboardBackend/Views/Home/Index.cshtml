@model ProductDashboard.Models.ViewModels.ProductListViewModel

<div class="dashboard-container" style="min-height: 70vh; background: linear-gradient(to bottom, #FDF6E3, #FFFFFF); padding: 2rem 0;">
    <!-- Loading Indicator - Themed -->
    <div id="loadingIndicator" class="text-center d-none py-5">
        <div class="spinner-border" role="status" style="width: 3rem; height: 3rem; color: #E67E22;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3" style="font-family: 'Playfair Display', serif; color: #2C3E50;">
            Preparing your experience...
        </p>
    </div>

    <!-- Dynamic Content Container -->
    <div id="contentContainer">
        <!-- Home content will be loaded here by default -->
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Scroll to top on page load
            window.scrollTo(0, 0);

            // Load home content by default
            loadHomeView();

            // Handle pagination clicks for products
            $(document).on('click', '.pagination .page-link[data-page]', function (e) {
                e.preventDefault();
                var page = $(this).data('page');
                var searchTerm = $('#searchInput').val();
                var categoryId = $('#categoryFilter').val();
                loadProducts(searchTerm, categoryId, page);
            });

            // Handle search and filter changes
            $('#searchInput, #categoryFilter').on('input change', function () {
                var searchTerm = $('#searchInput').val();
                var categoryId = $('#categoryFilter').val();
                loadProducts(searchTerm, categoryId, 1);
            });
        });

        // Navigation functions
        function loadHomeView() {
            showLoading();
            $('#contentContainer').load('@Url.Action("HomeContent", "Home")', function() {
                hideLoading();
                updateActiveNav('home');
                $('#searchFilterRow').hide(); // Hide search for home
                scrollToTop(); // Scroll to top after loading
            });
        }

        function loadProductsView() {
            showLoading();
            $('#contentContainer').load('@Url.Action("ProductList", "Home")', function() {
                hideLoading();
                updateActiveNav('products');
                $('#searchFilterRow').show(); // Show search for products
                scrollToTop(); // Scroll to top after loading
            });
        }

        function loadPromotionsView() {
            showLoading();
            $('#contentContainer').load('@Url.Action("Promotions", "Home")', function() {
                hideLoading();
                updateActiveNav('promotions');
                $('#searchFilterRow').hide();
                scrollToTop(); // Scroll to top after loading
            });
        }

        function loadCommunityView() {
            showLoading();
            $('#contentContainer').load('@Url.Action("Community", "Home")', function() {
                hideLoading();
                updateActiveNav('community');
                $('#searchFilterRow').hide();
                scrollToTop(); // Scroll to top after loading
            });
        }

        function loadProducts(searchTerm, categoryId, page) {
            showLoading();
            $.ajax({
                url: '@Url.Action("ProductList", "Home")',
                type: 'GET',
                data: {
                    searchTerm: searchTerm,
                    categoryId: categoryId,
                    page: page
                },
                success: function (result) {
                    $('#contentContainer').html(result);
                    scrollToTop(); // Scroll to top after loading products
                },
                error: function (xhr, status, error) {
                    console.error('Error loading products:', error);
                },
                complete: function () {
                    hideLoading();
                }
            });
        }

        function updateActiveNav(activeItem) {
            // Remove active class from all nav items
            $('.nav-link').removeClass('active').css('color', '#ECF0F1');
            $('.nav-link .position-absolute').css('transform', 'scaleX(0)');

            // Add active class to clicked item
            $(`a[onclick*="${activeItem}View"]`).addClass('active').css('color', '#DAA520');
            $(`a[onclick*="${activeItem}View"] .position-absolute`).css('transform', 'scaleX(1)');
        }

        function showLoading() {
            $('#loadingIndicator').removeClass('d-none');
            $('#contentContainer').addClass('opacity-50');
        }

        function hideLoading() {
            $('#loadingIndicator').addClass('d-none');
            $('#contentContainer').removeClass('opacity-50');
        }

        function clearFilters() {
            $('#searchInput').val('');
            $('#categoryFilter').val('');
            loadProducts('', '', 1);
        }

        // Scroll to top function
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    </script>

    <style>
        .opacity-50 {
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .dashboard-container {
            transition: opacity 0.3s ease-in-out;
        }

        #loadingIndicator {
            transition: all 0.3s ease-in-out;
        }

        /* Smooth appearance for content */
        #contentContainer > div {
            animation: fadeIn 0.5s ease-in-out;
        }

        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-link:hover:not(.disabled):not(.active) {
            background-color: #DAA520 !important;
            color: #2C3E50 !important;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        .page-link.disabled {
            background-color: #BDC3C7 !important;
            color: #7F8C8D !important;
            cursor: not-allowed;
        }
    </style>
}